function CreatePDFSealObject(objectIDString) {
  var bOK = $LoadControl("6D9BC9D1-9DDA-4A29-A6D0-DDB98E268191", objectIDString);
  if (!bOK) return alert("控件加载失败！"), NULL;
  var o = new Object,
    clt = eval(objectIDString);
  return o.Sign = function (a, b, c, d, e, f, g) {
    return clt.FileSealPDFJS(a, b, c, d, e, f, g)
  }, o.Verify = function (a, b, c) {
    return clt.FileVerify(a, b, c)
  }, o.CreateLocalFile = function (a, b) {
    return clt.CreateLocalFile(a, b)
  }, o.CreateFileCopy = function (a, b, c) {
    return clt.CreateFileCopy(a, b, c)
  }, o.DeleteFileCopy = function (a) {
    return clt.DeleteFileCopy(a)
  }, o.GetFileName = function () {
    return clt.FileName
  }, o.GetLocalFile = function (a, b) {
    return clt.GetLocalFile(a, b)
  }, o.OpenLocalFile = function () {
    return clt.OpenLocalFile()
  }, o.GetFileBuffer = function () {
    return clt.FileBuffer
  }, o.GetFileArray = function (a) {
    return clt.GetFileArray(a)
  }, o.GetLocalFileArray = function (a, b, c) {
    return clt.GetLocalFileArray(a, b, c)
  }, o.SealNullField = function (a, b, c) {
    return clt.FileSealNullSigField(a, b, c)
  }, o.SubmitForm = function (a) {
    return clt.SubmitForm(a)
  }, o.DownloadPDFByURL = function (a, b) {
    return clt.DownloadPDFByURL(a, b)
  }, o.FileExtractCert = function (a, b, c) {
    return clt.FileExtractCert_js(a, b, c)
  }, o.GetCertInfo = function () {
    return clt.CertInfo
  }, o
}

function $LoadControl(a, b) {
  var c = document.getElementById("pluginDiv" + b);
  c && (document.body.removeChild(c), c.innerHTML = "", c = null), c = document.createElement("div"), c.id = "pluginDiv" + b, document.body.appendChild(c);
  try {
    return $checkBrowserISIE() ? "Win32" == window.navigator.platform ? c.innerHTML = '<object id="' + b + '" classid="CLSID:' + a + '" codeBase="BJCAPdfSealApi.cab#version=1,0,0,1" style="POSITION: absolute; TOP: 10px; LEFT: 10px;"> <PARAM NAME="Visible" VALUE="true"> </object>' : c.innerHTML = '<object id="' + b + '" classid="CLSID:' + a + '" codeBase="BJCAPdfSealApi_x64.dll#version=1,0,0,1" style="POSITION: absolute; TOP: 10px; LEFT: 10px;"> <PARAM NAME="Visible" VALUE="true"> </object>' : c.innerHTML = "<embed id=" + b + " type=application/x-xtx-axhost clsid={" + a + "} width=0 height=0 />", !0
  } catch (d) {
    return document.body.removeChild(c), c.innerHTML = "", c = null, !1
  }
}

function $checkBrowserISIE() {
  return window.ActiveXObject || "ActiveXObject" in window ? !0 : !1
}

function BrowserSupport() {
  var a = navigator.userAgent,
    b = a.indexOf("Opera") > -1,
    c = a.indexOf("compatible") > -1 && a.indexOf("MSIE") > -1 && !b;
  a.indexOf("Windows NT 6.1; Trident/7.0;") > -1 && !c, a.indexOf("Firefox") > -1, a.indexOf("Safari") > -1 && -1 == a.indexOf("Chrome"), a.indexOf("Chrome") > -1 && a.indexOf("Safari") > -1;
  if (c) {
    var d = new RegExp("MSIE (\\d+\\.\\d+);");
    d.test(a);
    var e = parseFloat(RegExp.$1);
    return e > 9 ? !0 : !1
  }
  return !0
}

function arrayToString(a) {
  return 16 > a ? "0" + a.toString(16).toUpperCase() : a.toString(16).toUpperCase()
}

function stringToArray(a) {
  for (var b = a.length / 2, c = new Uint8Array(b), d = 0; b > d; d++) c[d] = parseInt(a.substring(2 * d, 2 * d + 2), 16);
  return c
}

function arrayToUint8Array(a, b) {
  for (var c = new Uint8Array(b), d = 0; b > d; d++) c[d] = a[d];
  return c
}

function CreatePDFTempFile(a, b) {
  var c, d = a.length;
  if (".pdf" == a.substring(d - 4, d)) {
    var e = a.lastIndexOf("\\"),
      f = "";
    switch (b) {
      case "verify":
        f = ".verify";
        break;
      case "sign":
        f = ".sign";
        break;
      case "nullfield":
        f = ".nullfield";
        break;
      case "certinfo":
        f = ".certinfo"
    }
    c = "C:\\PDFTemp\\" + a.substring(e + 1, d - 4) + f + ".pdf"
  } else alert("文件格式错误！");
  return c
}

function GetFileChange() {
  return bFileChange
}

function GetLocalFile() {
  return localFileName
}

function GetSigFile() {
  return sigFileName
}

function OpenArgvFile(a) {
  if (a)
    if (pdfsealObj) {
      var b = new Array(0),
        c = pdfsealObj.GetLocalFileArray(a, 0, b);
      if (c) {
        var d = new Uint8Array(c);
        b && (d = arrayToUint8Array(b, c), PDFViewerApplication.open(d), localFileName = a, curFileName = sigFileName, curFileArray = d, curFileLen = c)
      }
    } else alert("签章对象为空！");
  else alert("文件路径错误！")
}

function CreateSignMenu() {
  function a(a) {
    for (g = 0, f = 0; f < a.children.length; f++) {
      var b = a.children[f],
        c = b.clientWidth - 2 * parseInt(b.currentStyle ? b.currentStyle.paddingLeft : getComputedStyle(b, null).paddingLeft);
      c > g && (g = c)
    }
    for (f = 0; f < a.children.length; f++) a.children[f].style.width = g + "px"
  }
  var b = document.getElementById("sigMenu"),
    c = b.getElementsByTagName("ul"),
    d = b.getElementsByTagName("li"),
    e = hideTimer = null,
    f = 0,
    g = maxHeight = 0,
    h = [document.documentElement.offsetWidth, document.documentElement.offsetHeight];
  for (b.style.display = "none", b.onmouseover = function () {
      b.style.display = "block"
    }, b.onmouseout = function () {
      b.style.display = "none"
    }, f = 0; f < d.length; f++) d[f].getElementsByTagName("ul")[0] && (d[f].className = "sub"), d[f].onmouseover = function () {
    var b = this,
      c = b.getElementsByTagName("ul");
    b.className += " active", c[0] && (clearTimeout(hideTimer), e = setTimeout(function () {
      for (f = 0; f < b.parentNode.children.length; f++) b.parentNode.children[f].getElementsByTagName("ul")[0] && (b.parentNode.children[f].getElementsByTagName("ul")[0].style.display = "none");
      c[0].style.display = "block", c[0].style.top = b.offsetTop + "px", c[0].style.left = b.offsetWidth + "px", a(c[0]), g = h[0] - c[0].offsetWidth, maxHeight = h[1] - c[0].offsetHeight, g < getOffset.left(c[0]) && (c[0].style.left = -c[0].clientWidth + "px"), maxHeight < getOffset.top(c[0]) && (c[0].style.top = -c[0].clientHeight + b.offsetTop + b.clientHeight + "px")
    }, 300))
  }, d[f].onmouseout = function () {
    var a = this;
    a.getElementsByTagName("ul");
    a.className = a.className.replace(/\s?active/, ""), clearTimeout(e), hideTimer = setTimeout(function () {
      for (f = 0; f < a.parentNode.children.length; f++) a.parentNode.children[f].getElementsByTagName("ul")[0] && (a.parentNode.children[f].getElementsByTagName("ul")[0].style.display = "none")
    }, 300)
  }, d[f].onclick = function (a) {
    var b = this,
      c = document.getElementById(b.offsetParent.id).target;
    document.getElementById(b.offsetParent.id).style.display = "none", showSealInfo(b, c), document.getElementById(b.offsetParent.id).style.display = "none"
  };
  document.oncontextmenu = function (d) {
    var d = d || window.event,
      e = d.srcElement ? d.srcElement : d.target,
      f = !1;
    if ("annotation" === e.className) {
      for (var i = 0; i < sigArray.length; i++)
        if (sigArray[i].T === e.id) {
          f = !0;
          break
        } f && (b.style.display = "block", b.style.top = d.clientY - 2 + "px", b.style.left = d.clientX - 2 + "px", a(c[0]), g = h[0] - b.offsetWidth, maxHeight = h[1] - b.offsetHeight, b.offsetTop > maxHeight && (b.style.top = maxHeight + "px"), b.offsetLeft > g && (b.style.left = g + "px"), b.target = e.id)
    }
    return !1
  }, document.onclick = function () {
    b.style.display = "none"
  }
}

function showSealInfo(a, b) {
  document.getElementById("popDiv").style.display = "block", document.getElementById("bg").style.display = "block";
  for (var c = "", d = !1, e = 0; e < sigArray.length; e++)
    if (sigArray[e].T === b) {
      d = !0;
      for (var f = curFileArray, g = curFileLen, h = "", i = 0; g > i; i++) h += arrayToString(f[i]);
      var j = CreatePDFTempFile(localFileName, "certinfo");
      0 == pdfsealObj.CreateFileCopy(j, h, g) && (pdfsealObj.FileExtractCert(j, 1, 17) && alert("获取CN项错误"), c = pdfsealObj.GetCertInfo(), pdfsealObj.DeleteFileCopy(j));
      break
    } return d ? void("验证签章" === a.innerText ? alert(b + "验证签章") : "签章属性" === a.innerText ? (document.getElementById("PDFSeal_M").innerHTML = "签章时间：" + sigArray[e].M, document.getElementById("PDFSeal_Reason").innerHTML = "原因：" + sigArray[e].Reason, document.getElementById("PDFSeal_Location").innerHTML = "位置：" + sigArray[e].Location, document.getElementById("PDFSeal_CertInfo").innerHTML = "签章人：" + c) : "证书信息" === a.innerText && alert(b + "证书信息")) : void alert("获取信息错误")
}

function closeSealInfo() {
  document.getElementById("popDiv").style.display = "none", document.getElementById("bg").style.display = "none"
}

function GetSignStampPic() {
  return cur_cert_id = parent.document.getElementById("UserList").value, "" === cur_cert_id ? void alert("获取证书失败！") : void parent.ESeaL_GetStampPic(cur_cert_id, function (a) {
    var b = document.getElementById("sealPicDiv"),
      c = document.getElementById("sealPicDiv_Loc");
    return "" === a.retVal ? (b.style.backgroundImage = "", c.style.backgroundImage = "", sealImg.src = "", void alert("usb-key中无印章图片")) : (b.style.backgroundImage = "url(data:image/jpg;base64," + a.retVal + ")", c.style.backgroundImage = "url(data:image/jpg;base64," + a.retVal + ")", sealImg.src = "data:image/jpg;base64," + a.retVal, b.style.backgroundSize = "85% 85%", c.style.backgroundSize = "85% 85%", void(bSignReady = !0))
  })
}

function GetSignStampPicOfConst() {
  var a = document.getElementById("sealPicDiv"),
    b = document.getElementById("sealPicDiv_Loc");
  a.style.backgroundImage = "url(images/locate.gif)", b.style.backgroundImage = "url(images/locate.gif)", sealImg.src = "images/locate.gif", a.style.backgroundSize = "85% 85%", b.style.backgroundSize = "85% 85%", bSignReady = !0
}

function ClearLocalStorage() {
  localStorage.pageNum = 0
}

function setCookie(a, b, c) {
  var d = new Date;
  d.setTime(d.getTime() + 24 * c * 60 * 60 * 1e3);
  var e = "expires=" + d.toUTCString(),
    f = "path=/";
  document.cookie = a + "=" + b + "; " + e + "; " + f
}

function getCookie(a) {
  for (var b = a + "=", c = document.cookie.split(";"), d = 0; d < c.length; d++) {
    for (var e = c[d];
      " " == e.charAt(0);) e = e.substring(1);
    if (-1 != e.indexOf(b)) return e.substring(b.length, e.length)
  }
  return ""
}

function clearCookie(a) {
  setCookie(a, "", -1)
}

function AddWaterMark() {
  if (bWaterMark) {
    var a = decodeURI("%E8%AF%95%E7%94%A8%E7%89%88"),
      b = 40,
      c = 50,
      d = document.body.clientHeight / c,
      e = document.body.clientWidth / b;
    watermark({
      watermark_txt: a,
      watermark_y: 100,
      watermark_rows: d,
      watermark_cols: e,
      watermark_x_space: b,
      watermark_y_space: c
    })
  }
}

function watermark(a) {
  var b = {
    watermark_txt: "text",
    watermark_x: 20,
    watermark_y: 50,
    watermark_rows: 4,
    watermark_cols: 4,
    watermark_x_space: 100,
    watermark_y_space: 50,
    watermark_color: "#aaa",
    watermark_alpha: .4,
    watermark_fontsize: "45px",
    watermark_font: "微软雅黑",
    watermark_width: 210,
    watermark_height: 80,
    watermark_angle: 15
  };
  if (1 === arguments.length && "object" == typeof arguments[0]) {
    var c = arguments[0] || {};
    for (key in c) c[key] && b[key] && c[key] === b[key] || c[key] && (b[key] = c[key])
  }
  var d = document.createDocumentFragment(),
    e = Math.max(document.body.scrollWidth, document.body.clientWidth),
    f = .015 * e,
    e = e - f,
    g = Math.max(document.body.scrollHeight, document.body.clientHeight) + 450;
  (0 == b.watermark_cols || parseInt(b.watermark_x + b.watermark_width * b.watermark_cols + b.watermark_x_space * (b.watermark_cols - 1)) > e) && (b.watermark_cols = parseInt((e - b.watermark_x + b.watermark_x_space) / (b.watermark_width + b.watermark_x_space)), b.watermark_x_space = parseInt((e - b.watermark_x - b.watermark_width * b.watermark_cols) / (b.watermark_cols - 1))), (0 == b.watermark_rows || parseInt(b.watermark_y + b.watermark_height * b.watermark_rows + b.watermark_y_space * (b.watermark_rows - 1)) > g) && (b.watermark_rows = parseInt((b.watermark_y_space + g - b.watermark_y) / (b.watermark_height + b.watermark_y_space)), b.watermark_y_space = parseInt((g - b.watermark_y - b.watermark_height * b.watermark_rows) / (b.watermark_rows - 1)));
  for (var h, i, j = 0; j < b.watermark_rows; j++) {
    i = b.watermark_y + (b.watermark_y_space + b.watermark_height) * j;
    for (var k = 0; k < b.watermark_cols; k++) {
      h = b.watermark_x + (b.watermark_width + b.watermark_x_space) * k;
      var l = document.getElementById("mask_div" + j + k);
      void 0 != l && (l.parentNode.removeChild(l), l = null);
      var m = document.createElement("div");
      m.id = "mask_div" + j + k, m.className = "mask_div", m.appendChild(document.createTextNode(b.watermark_txt)), m.style.webkitTransform = "rotate(-" + b.watermark_angle + "deg)", m.style.MozTransform = "rotate(-" + b.watermark_angle + "deg)", m.style.msTransform = "rotate(-" + b.watermark_angle + "deg)", m.style.OTransform = "rotate(-" + b.watermark_angle + "deg)", m.style.transform = "rotate(-" + b.watermark_angle + "deg)", m.style.visibility = "", m.style.position = "absolute", m.style.left = h + "px", m.style.top = i + "px", m.style.overflow = "hidden", m.style.zIndex = "9999", m.style.pointerEvents = "none", m.style.opacity = b.watermark_alpha, m.style.fontSize = b.watermark_fontsize, m.style.fontFamily = b.watermark_font, m.style.color = b.watermark_color, m.style.textAlign = "center", m.style.width = b.watermark_width + "px", m.style.height = b.watermark_height + "px", m.style.display = "block", d.appendChild(m)
    }
  }
  document.body.appendChild(d)
}

function $onLoadFunc() {
  pdfsealObj = null, CreateSignMenu()
}

function AddOnLoadEvent(a) {
  var b = window.onload;
  "function" != typeof window.onload ? window.onload = a : (b(), a())
}
var pdfsealObj, sealPosX, sealPosY, getOffset = {
    top: function (a) {
      return a.offsetTop + (a.offsetParent ? arguments.callee(a.offsetParent) : 0)
    },
    left: function (a) {
      return a.offsetLeft + (a.offsetParent ? arguments.callee(a.offsetParent) : 0)
    }
  },
  cur_cert_id, sealImg = new Image,
  stampImg = new Array;
AddOnLoadEvent($onLoadFunc);
